import{_ as q}from"./loading.16b03cf4.js";import{_ as $}from"./checked.4cad9791.js";import{v as y,b as s,d as K,e as Z,f as V,w as n,N as H,t as P,o as _,g as t,h as c,a as l,C as O,W as J,l as k,i as Q,m as w,X as W,D as B,c as X,O as G,Q as A,p as Y}from"./index.973f2d2f.js";import{_ as ee,a as oe,b as ae}from"./TableDetPrmReg.3c9104b6.js";import{g as te}from"./getData.5726d001.js";const le=l("img",{src:q,alt:"",class:"block mx-auto"},null,-1),se=l("p",null,"\xBFEst\xE1 seguro que desea subir esta promoci\xF3n a Merksyst? ",-1),re=l("p",null,"\xBFEst\xE1 seguro que desea denegar esta promoci\xF3n? ",-1),ne=l("img",{src:$,alt:"",class:"block mx-auto"},null,-1),ue=l("img",{src:$,alt:"",class:"block mx-auto"},null,-1),ie=l("div",null,[A("Creada el: "),l("span",{id:"created_at"})],-1),ce=l("div",null,[A("\xDAlt. actualizaci\xF3n: "),l("span",{id:"updated_at"})],-1),me={class:"leading-tight text-lg underline underline-offset-4 font-medium"},de=l("div",{class:"my-6"},null,-1),pe={key:1,class:"leading-tight text-lg underline-offset-4 font-medium mb-6 mt-6 pt-3 pb-3"},Ce={__name:"AutorizarPromocion",setup(fe){const v=y(()=>u.value.prom),g=Y(),h=s(!0),r=K(),u=s([]),T=y(()=>u.value.suc);async function E(o="",e={}){return(await fetch(o,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)})).json()}const L=y(()=>m.value),S=async function(){let o=await te(P+"promocion-aut?idprom="+r.numProm+"&compr="+r.nomCto);if(o.ok)await o.json().then(e=>{u.value=e,m.value=u.value.arts,console.log(u.value.arts)});else return console.log("Respuesta de red OK pero respuesta HTTP no OK"),{}},m=s([]),z=s(1);Z(async function(){await S();let o=new Date(u.value.prom.created_at),e="------------";u.value.prom.updated_at!=null&&(e=new Date(u.value.prom.updated_at).toLocaleString("es",{timeZone:"America/Chihuahua"})),o=o.toLocaleString("es",{timeZone:"America/Chihuahua"}),document.getElementById("created_at").textContent=o,document.getElementById("updated_at").textContent=e,h.value=!1,z.value=u.value.prom.status,parseInt(z.value)==0?F():U(),I.value=v.value.tpoProm==1,i.value=v.value.tpoProm});function U(){let o=document.getElementsByClassName("btns");for(let e=0;e<o.length;e++)o[e].classList.add("hidden")}function F(){let o=document.getElementsByClassName("btns");for(let e=0;e<o.length;e++)o[e].classList.remove("hidden")}const d=s(!1),I=s(!0),i=s(),b=s(!1),D=s(!1),p=s(!1),C=s("");function x(o){return new Promise(e=>setTimeout(e,o))}async function M(){console.log("autorizando"),console.log(r.numProm,r);let o={idprom:r.numProm,compr:r.nomCto};await E(P+"aut-prom",o).then(async e=>{console.log("respuesta post"),console.log(e),"error"in e?(console.log("Tiene errores"),C.value="Ocurri\xF3 un error al guardar. "+e.error,d.value=!0):(console.log("NO tiene errores"),f.value=!0,await x(1500),f.value=!1,g.push({path:"/vistapromo/prom-aut"}))})}function j(){g.push({path:"/vistapromo/editar-prom"})}async function N(){console.log("denegando"),console.log(r.numProm,r);let o={idprom:r.numProm,compr:r.nomCto};await E(P+"rechazar-prom",o).then(async e=>{console.log("respuesta post"),console.log(e),"error"in e?(console.log("Tiene errores"),C.value="Ocurri\xF3 un error al guardar. "+e.error,d.value=!0):(console.log("NO tiene errores"),p.value=!0,await x(1500),p.value=!1,g.push({path:"/vistapromo/prom-aut"}))})}function R(){b.value=!0}const f=s(!1);return(o,e)=>(_(),V(H,null,{default:n(()=>[t(G,null,{default:n(()=>[t(c,{hasFooter:!1,modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),blocked:!0,title:"Cargando la informaci\xF3n"},{default:n(()=>[le]),_:1},8,["modelValue"]),t(c,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=a=>b.value=a),title:"Autorizar promoci\xF3n",button:"success",hasFooter:!0,hasButton:"",hasCancel:"",onConfirm:M},{default:n(()=>[se]),_:1},8,["modelValue"]),t(c,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=a=>D.value=a),title:"Denegar promoci\xF3n",button:"info",hasFooter:!0,hasButton:"",hasCancel:"",buttonLabel:"Denegar",onConfirm:N},{default:n(()=>[re]),_:1},8,["modelValue"]),t(c,{hasFooter:!1,modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value=a),title:"Promoci\xF3n denegada correctamente",blocked:!0},{default:n(()=>[ne]),_:1},8,["modelValue"]),t(c,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),title:"No se pudo guardar la promoci\xF3n",button:"secondary",hasButton:""},{default:n(()=>[l("p",null,O(C.value),1)]),_:1},8,["modelValue"]),t(c,{hasFooter:!1,modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),title:"Promoci\xF3n Creada Correctamente",blocked:!0},{default:n(()=>[ue]),_:1},8,["modelValue"]),t(J,{title:"Autorizar Promoci\xF3n",hasBack:"/prom-aut",alto:"h-8",ancho:"w-8"},{default:n(()=>[ie,ce,l("div",null,[t(k,{id:"btn_autorizar",color:"success",class:"btns mr-3",label:"Autorizar",small:"","data-label":"promo.id",onClick:R}),t(k,{id:"btn_edit",color:"info",class:"btns mr-3",label:"Editar",small:"","data-label":"promo.id",onClick:j}),t(k,{id:"btn_cancelar",color:"danger",class:"btns mr-3",label:"Cancelar",small:"","data-label":"promo.id",onClick:N})])]),_:1}),t(Q,{class:"mb-6"},{default:n(()=>[t(ee,{prmhdr:w(v),sucs:w(T)},null,8,["prmhdr","sucs"]),t(W),l("h1",me,"Art\xEDculos Capturados: "+O(w(L).length),1),de,i.value==5||i.value==6?(_(),V(oe,{key:0,promos:m.value},null,8,["promos"])):B("",!0),i.value==6?(_(),X("h1",pe,"DETALLE DE PRECIOS")):B("",!0),i.value==1||i.value==6?(_(),V(ae,{key:2,promos:m.value},null,8,["promos"])):B("",!0)]),_:1})]),_:1})]),_:1}))}};export{Ce as default};
