import{_ as R}from"./loading.16b03cf4.js";import{_ as O}from"./checked.4cad9791.js";import{v as C,b as s,d as q,e as K,f as y,w as n,N as Z,t as V,o as _,g as t,h as c,a as l,C as N,W as H,l as P,i as J,m as k,X as Q,D as w,c as W,O as X,Q as $,p as G}from"./index.2fe6260c.js";import{_ as Y,a as ee,b as oe}from"./TableDetPrmReg.aa18de10.js";import{g as ae}from"./getData.5726d001.js";const te=l("img",{src:R,alt:"",class:"block mx-auto"},null,-1),le=l("p",null,"\xBFEst\xE1 seguro que desea subir esta promoci\xF3n a Merksyst? ",-1),se=l("p",null,"\xBFEst\xE1 seguro que desea denegar esta promoci\xF3n? ",-1),re=l("img",{src:O,alt:"",class:"block mx-auto"},null,-1),ne=l("img",{src:O,alt:"",class:"block mx-auto"},null,-1),ue=l("div",null,[$("Creada el: "),l("span",{id:"created_at"})],-1),ie=l("div",null,[$("\xDAlt. actualizaci\xF3n: "),l("span",{id:"updated_at"})],-1),ce={class:"leading-tight text-lg underline underline-offset-4 font-medium"},me=l("div",{class:"my-6"},null,-1),de={key:1,class:"leading-tight text-lg underline-offset-4 font-medium mb-6 mt-6 pt-3 pb-3"},be={__name:"AutorizarPromocion",setup(pe){const g=C(()=>u.value.prom),B=G(),v=s(!0),r=q(),u=s([]),A=C(()=>u.value.suc);async function D(o="",e={}){return(await fetch(o,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)})).json()}const T=C(()=>m.value),L=async function(){let o=await ae(V+"promocion-aut?idprom="+r.numProm+"&compr="+r.nomCto);if(o.ok)await o.json().then(e=>{u.value=e,m.value=u.value.arts,console.log(u.value.arts)});else return console.log("Respuesta de red OK pero respuesta HTTP no OK"),{}},m=s([]),z=s(1);K(async function(){await L();let o=new Date(u.value.prom.created_at),e="------------";u.value.prom.updated_at!=null&&(e=new Date(u.value.prom.updated_at).toLocaleString("es",{timeZone:"America/Chihuahua"})),o=o.toLocaleString("es",{timeZone:"America/Chihuahua"}),document.getElementById("created_at").textContent=o,document.getElementById("updated_at").textContent=e,v.value=!1,z.value=u.value.prom.status,parseInt(z.value)==0?U():S(),F.value=g.value.tpoProm==1,i.value=g.value.tpoProm});function S(){let o=document.getElementsByClassName("btns");for(let e=0;e<o.length;e++)o[e].classList.add("hidden")}function U(){let o=document.getElementsByClassName("btns");for(let e=0;e<o.length;e++)o[e].classList.remove("hidden")}const d=s(!1),F=s(!0),i=s(),h=s(!1),E=s(!1),p=s(!1),b=s("");function x(o){return new Promise(e=>setTimeout(e,o))}async function I(){console.log("autorizando"),console.log(r.numProm,r);let o={idprom:r.numProm,compr:r.nomCto};await D(V+"aut-prom",o).then(async e=>{console.log("respuesta post"),console.log(e),"error"in e?(console.log("Tiene errores"),b.value="Ocurri\xF3 un error al guardar. "+e.error,d.value=!0):(console.log("NO tiene errores"),f.value=!0,await x(1500),f.value=!1,B.push({path:"/prom-aut"}))})}async function M(){console.log("denegando"),console.log(r.numProm,r);let o={idprom:r.numProm,compr:r.nomCto};await D(V+"rechazar-prom",o).then(async e=>{console.log("respuesta post"),console.log(e),"error"in e?(console.log("Tiene errores"),b.value="Ocurri\xF3 un error al guardar. "+e.error,d.value=!0):(console.log("NO tiene errores"),p.value=!0,await x(1500),p.value=!1,B.push({path:"/prom-aut"}))})}function j(){h.value=!0}const f=s(!1);return(o,e)=>(_(),y(Z,null,{default:n(()=>[t(X,null,{default:n(()=>[t(c,{hasFooter:!1,modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),blocked:!0,title:"Cargando la informaci\xF3n"},{default:n(()=>[te]),_:1},8,["modelValue"]),t(c,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),title:"Autorizar promoci\xF3n",button:"success",hasFooter:!0,hasButton:"",hasCancel:"",onConfirm:I},{default:n(()=>[le]),_:1},8,["modelValue"]),t(c,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=a=>E.value=a),title:"Denegar promoci\xF3n",button:"info",hasFooter:!0,hasButton:"",hasCancel:"",buttonLabel:"Denegar",onConfirm:M},{default:n(()=>[se]),_:1},8,["modelValue"]),t(c,{hasFooter:!1,modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value=a),title:"Promoci\xF3n denegada correctamente",blocked:!0},{default:n(()=>[re]),_:1},8,["modelValue"]),t(c,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),title:"No se pudo guardar la promoci\xF3n",button:"secondary",hasButton:""},{default:n(()=>[l("p",null,N(b.value),1)]),_:1},8,["modelValue"]),t(c,{hasFooter:!1,modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),title:"Promoci\xF3n Creada Correctamente",blocked:!0},{default:n(()=>[ne]),_:1},8,["modelValue"]),t(H,{title:"Autorizar Promoci\xF3n",hasBack:"/prom-aut",alto:"h-8",ancho:"w-8"},{default:n(()=>[ue,ie,l("div",null,[t(P,{id:"btn_autorizar",color:"success",class:"btns mr-3",label:"Autorizar",small:"","data-label":"promo.id",onClick:j}),t(P,{id:"btn_delete",color:"danger",class:"hidden",label:"Denegar",small:"","data-label":"promo.id"}),t(P,{id:"btn_edit",color:"info",class:"btns mr-3",label:"Editar",small:"","data-label":"promo.id",to:"/editar-prom"})])]),_:1}),t(J,{class:"mb-6"},{default:n(()=>[t(Y,{prmhdr:k(g),sucs:k(A)},null,8,["prmhdr","sucs"]),t(Q),l("h1",ce,"Art\xEDculos Capturados: "+N(k(T).length),1),me,i.value==5||i.value==6?(_(),y(ee,{key:0,promos:m.value},null,8,["promos"])):w("",!0),i.value==6?(_(),W("h1",de,"DETALLE DE PRECIOS")):w("",!0),i.value==1||i.value==6?(_(),y(oe,{key:2,promos:m.value},null,8,["promos"])):w("",!0)]),_:1})]),_:1})]),_:1}))}};export{be as default};
