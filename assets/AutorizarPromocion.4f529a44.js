import{_ as R}from"./loading.16b03cf4.js";import{_ as x}from"./checked.4cad9791.js";import{v as O,b as s,d as K,e as Z,f as h,w as n,N as H,t as b,o as f,g as t,h as v,a as l,C as $,W as J,l as z,i as Q,m as E,X as W,D as C,c as X,O as G,Q as T,p as Y}from"./index.ffe89dd0.js";import{_ as ee,a as oe,b as ae,c as te,d as le}from"./TableDetPrmCmbXPre.7904c43b.js";import{g as re}from"./getData.5726d001.js";const se=l("img",{src:R,alt:"",class:"block mx-auto"},null,-1),ne=l("p",null,"\xBFEst\xE1 seguro que desea subir esta promoci\xF3n a Merksyst? ",-1),ue=l("p",null,"\xBFEst\xE1 seguro que desea denegar esta promoci\xF3n? ",-1),ie=l("img",{src:x,alt:"",class:"block mx-auto"},null,-1),ce=l("img",{src:x,alt:"",class:"block mx-auto"},null,-1),me=l("div",null,[T("Creada el: "),l("span",{id:"created_at"})],-1),de=l("div",null,[T("\xDAlt. actualizaci\xF3n: "),l("span",{id:"updated_at"})],-1),pe={class:"leading-tight text-lg underline underline-offset-4 font-medium"},fe=l("div",{class:"my-6"},null,-1),ve={key:3,class:"leading-tight text-lg underline-offset-4 font-medium mb-6 mt-6 pt-3 pb-3"},Pe={__name:"AutorizarPromocion",setup(_e){const k=O(()=>u.value.prom),_=Y(),y=s(!0),r=K(),u=s([]),A=O(()=>u.value.suc);async function P(a="",e={}){return(await fetch(a,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)})).json()}const S=O(()=>c.value),L=async function(){let a=await re(b+"promocion-aut?idprom="+r.numProm+"&compr="+r.nomCto);if(a.ok)await a.json().then(e=>{u.value=e,c.value=u.value.arts,console.log(u.value.arts)});else return console.log("Respuesta de red OK pero respuesta HTTP no OK"),{}},c=s([]),w=s(1);Z(async function(){console.log("Se puede editar",w.value),await L();let a=new Date(u.value.prom.created_at),e="------------";u.value.prom.updated_at!=null&&(e=new Date(u.value.prom.updated_at).toLocaleString("es",{timeZone:"America/Chihuahua"})),a=a.toLocaleString("es",{timeZone:"America/Chihuahua"}),document.getElementById("created_at").textContent=a,document.getElementById("updated_at").textContent=e,y.value=!1,w.value=u.value.prom.status,parseInt(w.value)==0?F():U(),I.value=k.value.tpoProm==1,i.value=k.value.tpoProm});function U(){let a=document.getElementsByClassName("btns");for(let e=0;e<a.length;e++)a[e].classList.add("hidden")}function F(){let a=document.getElementsByClassName("btns");for(let e=0;e<a.length;e++)a[e].classList.remove("hidden")}const m=s(!1),I=s(!0),i=s(),B=s(!1),N=s(!1),d=s(!1),g=s("");function V(a){return new Promise(e=>setTimeout(e,a))}async function M(){console.log("autorizando"),console.log(r.numProm,r);let a={idprom:r.numProm,compr:r.nomCto};var e=r.numProm.split(" ");e[1]==2||e[1]==3?(console.log("aqui se imprimen los datos: "+a),console.log(a),await P(b+"aut-cmb",a).then(async o=>{console.log("respuesta post"),console.log(o),"error"in o?(console.log("Tiene errores"),g.value="Ocurri\xF3 un error al guardar. "+o.error,m.value=!0):(console.log("NO tiene errores"),p.value=!0,await V(1500),p.value=!1,_.push({path:"/vistapromo/prom-aut"}))})):await P(b+"aut-prom",a).then(async o=>{console.log("respuesta post"),console.log(o),"error"in o?(console.log("Tiene errores"),g.value="Ocurri\xF3 un error al guardar. "+o.error,m.value=!0):(console.log("NO tiene errores"),p.value=!0,await V(1500),p.value=!1,_.push({path:"/vistapromo/prom-aut"}))})}function j(){_.push({path:"/vistapromo/editar-prom"})}async function D(){console.log("denegando"),console.log(r.numProm,r);var a=r.numProm.split(" ");let e={idprom:r.numProm,compr:r.nomCto};a[1]==2||a[1]==3?await P(b+"rechazar-cmb",e).then(async o=>{console.log("respuesta post"),console.log(o),"error"in o?(console.log("Tiene errores"),g.value="Ocurri\xF3 un error al guardar. "+o.error,m.value=!0):(console.log("NO tiene errores"),d.value=!0,await V(1500),d.value=!1,_.push({path:"/vistapromo/prom-aut"}))}):await P(b+"rechazar-prom",e).then(async o=>{console.log("respuesta post"),console.log(o),"error"in o?(console.log("Tiene errores"),g.value="Ocurri\xF3 un error al guardar. "+o.error,m.value=!0):(console.log("NO tiene errores"),d.value=!0,await V(1500),d.value=!1,_.push({path:"/vistapromo/prom-aut"}))})}function q(){y.value=!0,B.value=!0}const p=s(!1);return(a,e)=>(f(),h(H,null,{default:n(()=>[t(G,null,{default:n(()=>[t(v,{hasFooter:!1,modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),blocked:!0,title:"Creando Promocion, por favor espere"},{default:n(()=>[se]),_:1},8,["modelValue"]),t(v,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=o=>B.value=o),title:"Autorizar promoci\xF3n",button:"success",hasFooter:!0,hasButton:"",hasCancel:"",onConfirm:M},{default:n(()=>[ne]),_:1},8,["modelValue"]),t(v,{modelValue:N.value,"onUpdate:modelValue":e[2]||(e[2]=o=>N.value=o),title:"Denegar promoci\xF3n",button:"info",hasFooter:!0,hasButton:"",hasCancel:"",buttonLabel:"Denegar",onConfirm:D},{default:n(()=>[ue]),_:1},8,["modelValue"]),t(v,{hasFooter:!1,modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value=o),title:"Promoci\xF3n denegada correctamente",blocked:!0},{default:n(()=>[ie]),_:1},8,["modelValue"]),t(v,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=o=>m.value=o),title:"No se pudo guardar la promoci\xF3n",button:"secondary",hasButton:""},{default:n(()=>[l("p",null,$(g.value),1)]),_:1},8,["modelValue"]),t(v,{hasFooter:!1,modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value=o),title:"Promoci\xF3n Creada Correctamente",blocked:!0},{default:n(()=>[ce]),_:1},8,["modelValue"]),t(J,{title:"Autorizar Promoci\xF3n",hasBack:"/prom-aut",alto:"h-8",ancho:"w-8"},{default:n(()=>[me,de,l("div",null,[t(z,{id:"btn_autorizar",color:"success",class:"btns mr-3",label:"Autorizar",small:"","data-label":"promo.id",onClick:q}),t(z,{id:"btn_edit",color:"info",class:"btns mr-3",label:"Editar",small:"","data-label":"promo.id",onClick:j}),t(z,{id:"btn_cancelar",color:"danger",class:"btns mr-3",label:"Cancelar",small:"","data-label":"promo.id",onClick:D})])]),_:1}),t(Q,{class:"mb-6"},{default:n(()=>[t(ee,{prmhdr:E(k),sucs:E(A)},null,8,["prmhdr","sucs"]),t(W),l("h1",pe,"Art\xEDculos Capturados: "+$(E(S).length),1),fe,i.value==5||i.value==6?(f(),h(oe,{key:0,promos:c.value},null,8,["promos"])):C("",!0),i.value==2?(f(),h(ae,{key:1,promos:c.value},null,8,["promos"])):C("",!0),i.value==3?(f(),h(te,{key:2,promos:c.value},null,8,["promos"])):C("",!0),i.value==6?(f(),X("h1",ve,"DETALLE DE PRECIOS")):C("",!0),i.value==1||i.value==6?(f(),h(le,{key:4,promos:c.value},null,8,["promos"])):C("",!0)]),_:1})]),_:1})]),_:1}))}};export{Pe as default};
